{% extends 'base.html' %}
{% block content %}
<style>
    /* Enhanced modern design */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        --card-shadow-hover: 0 15px 50px rgba(0, 0, 0, 0.12);
    }
    
    .hero {
        background: linear-gradient(135deg, rgba(10, 132, 255, 0.15), rgba(88, 86, 214, 0.1));
        border-radius: 1rem;
        padding: 4rem 1.5rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
    }
    
    .hero h1 {
        font-weight: 800;
        letter-spacing: -0.5px;
        margin-bottom: 1rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .hero p {
        font-size: 1.1rem;
        opacity: 0.85;
        max-width: 600px;
        margin: 0 auto 2rem;
    }
    
    .search-box {
        max-width: 600px;
        margin: 0 auto;
        position: relative;
    }
    
    .search-box input {
        border-radius: 50px;
        padding: 1rem 1.5rem;
        border: 2px solid #e5e7eb;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .search-box input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .search-box button {
        border-radius: 50px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        background: var(--primary-gradient);
        border: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .search-box button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    
    /* Featured Carousel Enhancements */
    #featuredCarousel .carousel-item {
        background: white;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        transition: transform 0.3s ease;
    }
    
    #featuredCarousel .carousel-item:hover {
        transform: translateY(-5px);
    }
    
    .carousel-control-prev,
    .carousel-control-next {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    #featuredCarousel:hover .carousel-control-prev,
    #featuredCarousel:hover .carousel-control-next {
        opacity: 1;
    }
    
    /* Genre Chips - Enhanced */
    .genre-container {
        position: relative;
        padding-bottom: 1rem;
    }
    
    .badge-genre {
        cursor: pointer;
        user-select: none;
        padding: 0.5rem 1rem;
        font-weight: 500;
        border-radius: 50px;
        transition: all 0.2s ease;
        border: 2px solid transparent;
    }
    
    .badge-genre:not(.active):hover {
        transform: translateY(-2px);
        border-color: #e5e7eb;
        background: white;
    }
    
    .badge-genre.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
    }
    
    /* Cards - Enhanced */
    .card-movie {
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        cursor: pointer;
        border: none;
        overflow: hidden;
        position: relative;
        opacity: 0;
        animation: fadeInUp 0.6s ease forwards;
    }
    
    .card-movie:nth-child(2) { animation-delay: 0.1s; }
    .card-movie:nth-child(3) { animation-delay: 0.2s; }
    .card-movie:nth-child(4) { animation-delay: 0.3s; }
    
    .card-movie::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }
    
    .card-movie:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--card-shadow-hover);
    }
    
    .card-movie:hover::before {
        transform: scaleX(1);
    }
    
    .card-img-top {
        height: 320px;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .card-movie:hover .card-img-top {
        transform: scale(1.05);
    }
    
    .card-body {
        background: white;
        position: relative;
        z-index: 1;
    }
    
    .card-title {
        font-weight: 700;
        font-size: 1rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .card-text {
        font-size: 0.85rem;
        opacity: 0.7;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* Genre badges inside cards */
    .genre-badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
        background: #f3f4f6;
        color: #4b5563;
    }
    
    /* Preview button */
    .btn-view {
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        font-weight: 600;
        font-size: 0.85rem;
        border-radius: 6px;
        transition: all 0.3s ease;
    }
    
    .btn-view:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    /* Empty state */
    .empty-state {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border: 2px dashed #cbd5e1;
        border-radius: 1rem;
        padding: 4rem 2rem;
    }
    
    .empty-state h5 {
        color: #475569;
        margin-bottom: 0.5rem;
    }
    
    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Pulse animation for CTA */
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
        100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
    }
    
    .pulse {
        animation: pulse 2s infinite;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .hero {
            padding: 3rem 1rem;
        }
        
        .hero h1 {
            font-size: 2rem;
        }
        
        .card-img-top {
            height: 250px;
        }
        
        .carousel-control-prev,
        .carousel-control-next {
            opacity: 1;
            width: 40px;
            height: 40px;
        }
    }
</style>

<header class="hero text-dark text-center">
    <div class="container">
        <h1>Movies Store</h1>
        <p class="mb-4">Your Ticket to Unlimited Entertainment ‚Äî discover, filter and preview in one place.</p>
        
        <div class="search-box">
            <form method="get" class="row g-2">
                <div class="col-12 col-md-10">
                    <input name="q" value="{{ request.GET.q }}" class="form-control"
                        placeholder="Search movies, actors, directors..." 
                        aria-label="Search"
                        id="searchInput" />
                </div>
                <div class="col-12 col-md-2">
                    <button class="btn btn-primary w-100">Search</button>
                </div>
            </form>
            <div class="mt-3 text-muted small" id="searchHint">
                Try: "action", "comedy", or actor names
            </div>
        </div>
    </div>
</header>

<div class="container pb-5">
    <!-- Featured Carousel -->
    {% if featured %}
    <div class="mb-5">
        <h4 class="mb-3 d-flex align-items-center">
            <span style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Featured Movies</span>
            <span class="ms-2" style="font-size: 1.2rem;">üé¨</span>
        </h4>
        <div id="featuredCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
            <div class="carousel-inner rounded">
                {% for m in featured %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <div class="d-flex align-items-center p-4">
                        <div class="me-4" style="width:130px; flex-shrink:0;">
                            <img src="{% if m.poster %}{{ m.poster.url }}{% else %}/static/img/placeholder-film.png{% endif %}"
                                class="img-fluid rounded shadow-sm" alt="{{ m.title }}" style="height:180px; object-fit:cover;">
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-2">{{ m.title }}</h5>
                            <p class="mb-3 text-muted">{{ m.tagline|default:m.short_description|default:"Featured pick" }}</p>
                            <div class="d-flex gap-2">
                                {% if m.rating %}
                                <span class="badge bg-warning text-dark">‚≠ê {{ m.rating }}</span>
                                {% endif %}
                                {% if m.year %}
                                <span class="badge bg-light text-dark">{{ m.year }}</span>
                                {% endif %}
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-view pulse btn-quick-view" 
                                    data-title="{{ m.title }}"
                                    data-desc="{{ m.description|default:'' }}"
                                    data-poster="{% if m.poster %}{{ m.poster.url }}{% endif %}"
                                    data-year="{{ m.year|default:'' }}"
                                    data-rating="{{ m.rating|default:'' }}"
                                    data-genres="{% for g in m.genres.all %}{{ g.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
                                    Quick Preview
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon bg-dark rounded-circle p-2"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon bg-dark rounded-circle p-2"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    {% endif %}
    
    <!-- Genre Filter -->
    {% if genres %}
    <div class="genre-container mb-4">
        <h5 class="mb-3">Browse by Genre</h5>
        <div class="d-flex flex-wrap gap-2" id="genreFilter">
            <span class="badge badge-genre active" data-genre="">All Genres</span>
            {% for g in genres %}
            <span class="badge badge-genre bg-light text-dark" data-genre="{{ g.name }}">
                {{ g.name }}
            </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Movies Grid -->
    <div id="moviesGrid" class="row g-4">
        {% if movies %}
        {% for movie in movies %}
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card card-movie h-100"
                data-genre-list="{% for gg in movie.genres.all %}{{ gg.name }}|{% endfor %}"
                data-title="{{ movie.title }}"
                data-desc="{{ movie.description|default:'No description available'|truncatechars:200 }}"
                data-poster="{% if movie.poster %}{{ movie.poster.url }}{% else %}/static/img/placeholder-film.png{% endif %}"
                data-year="{{ movie.year|default:'' }}"
                data-rating="{{ movie.rating|default:'' }}"
                data-genres="{% for gg in movie.genres.all %}{{ gg.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
                <img src="{% if movie.poster %}{{ movie.poster.url }}{% else %}/static/img/placeholder-film.png{% endif %}"
                    class="card-img-top" alt="{{ movie.title }}">
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title mb-2">{{ movie.title }}</h6>
                    <div class="mb-2">
                        {% if movie.year %}
                        <span class="text-muted small me-2">{{ movie.year }}</span>
                        {% endif %}
                        {% if movie.rating %}
                        <span class="text-warning small">‚òÖ {{ movie.rating }}</span>
                        {% endif %}
                    </div>
                    <p class="card-text mb-3 small flex-grow-1">
                        {{ movie.short_description|default:movie.description|default:"No description available"|truncatechars:80 }}
                    </p>
                    <div class="mt-auto">
                        <div class="mb-3">
                            {% for gg in movie.genres.all|slice:":2" %}
                            <span class="badge genre-badge me-1">{{ gg.name }}</span>
                            {% endfor %}
                            {% if movie.genres.count > 2 %}
                            <span class="badge genre-badge">+{{ movie.genres.count|add:"-2" }}</span>
                            {% endif %}
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-primary fw-bold small">
                                {% if movie.price %}
                                ${{ movie.price }}
                                {% endif %}
                            </span>
                            <button class="btn btn-sm btn-view btn-quick-view">Preview</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="col-12">
            <div class="empty-state text-center">
                <div class="mb-3" style="font-size: 3rem;">üé•</div>
                <h5>No movies found</h5>
                <p class="mb-0 text-muted">Try changing filters or search terms</p>
                <button class="btn btn-outline-primary mt-3" onclick="clearFilters()">Clear All Filters</button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Enhanced Quick View Modal -->
<div class="modal fade" id="movieModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content overflow-hidden" style="border-radius: 1rem;">
            <div class="modal-body p-0">
                <button type="button" class="btn-close position-absolute top-0 end-0 m-3 bg-white rounded-circle p-2" 
                        data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="row g-0">
                    <div class="col-md-5 position-relative">
                        <img id="modalPoster" src="/static/img/placeholder-film.png" 
                             class="img-fluid h-100 w-100" style="object-fit:cover" alt="">
                        <div class="position-absolute bottom-0 start-0 p-3 text-white" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); width: 100%;">
                            <div class="d-flex align-items-center gap-2">
                                <span id="modalRating" class="badge bg-warning text-dark">‚≠ê 0.0</span>
                                <span id="modalYear" class="badge bg-white text-dark">2024</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7 p-4 d-flex flex-column">
                        <div>
                            <h4 id="modalTitle" class="mb-2"></h4>
                            <div id="modalGenres" class="mb-3"></div>
                            <p id="modalDesc" class="text-muted mb-4"></p>
                        </div>
                        <div class="mt-auto">
                            <div class="d-flex gap-2">
                                <a href="#" id="modalDetailsLink" class="btn btn-primary flex-grow-1">
                                    View Full Details
                                </a>
                                <button class="btn btn-outline-primary" id="addToCartBtn">
                                    <span class="me-1">üõí</span> Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        // Enhanced genre filtering with animations
        const genres = document.querySelectorAll('.badge-genre');
        const cards = Array.from(document.querySelectorAll('#moviesGrid .card-movie'));
        const searchInput = document.getElementById('searchInput');
        const searchHint = document.getElementById('searchHint');
        
        // Track active genre
        let activeGenre = '';
        
        // Genre filter with smooth animations
        function filterByGenre(name) {
            activeGenre = name;
            
            // Update active state
            genres.forEach(genre => {
                if (genre.dataset.genre === name) {
                    genre.classList.remove('bg-light', 'text-dark');
                    genre.classList.add('active');
                } else {
                    genre.classList.remove('active');
                    genre.classList.add('bg-light', 'text-dark');
                }
            });
            
            // Filter cards with animation
            cards.forEach(card => {
                const list = (card.dataset.genreList || '').toLowerCase();
                const parent = card.parentElement;
                
                if (!name || name === '' || list.includes(name.toLowerCase() + '|')) {
                    parent.style.display = 'block';
                    setTimeout(() => {
                        parent.style.opacity = '1';
                        parent.style.transform = 'translateY(0)';
                    }, 10);
                } else {
                    parent.style.opacity = '0';
                    parent.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        parent.style.display = 'none';
                    }, 300);
                }
            });
        }
        
        // Search input focus effects
        if (searchInput) {
            searchInput.addEventListener('focus', function() {
                searchHint.style.opacity = '1';
            });
            
            searchInput.addEventListener('blur', function() {
                searchHint.style.opacity = '0.7';
            });
            
            // Clear placeholder on focus
            searchInput.addEventListener('focus', function() {
                if (this.value === '') {
                    this.placeholder = 'Try "action", "comedy", or actor names...';
                }
            });
            
            searchInput.addEventListener('blur', function() {
                if (this.value === '') {
                    this.placeholder = 'Search movies, actors, directors...';
                }
            });
        }
        
        // Enhanced modal functionality
        const modal = new bootstrap.Modal(document.getElementById('movieModal'));
        const modalTitle = document.getElementById('modalTitle');
        const modalDesc = document.getElementById('modalDesc');
        const modalPoster = document.getElementById('modalPoster');
        const modalRating = document.getElementById('modalRating');
        const modalYear = document.getElementById('modalYear');
        const modalGenres = document.getElementById('modalGenres');
        const modalDetailsLink = document.getElementById('modalDetailsLink');
        const addToCartBtn = document.getElementById('addToCartBtn');
        
        function openModalFromData(element) {
            const card = element.closest('.card-movie') || element;
            const title = card.dataset.title || '';
            const desc = card.dataset.desc || '';
            const poster = card.dataset.poster || '/static/img/placeholder-film.png';
            const year = card.dataset.year || '';
            const rating = card.dataset.rating || '';
            const genres = card.dataset.genres || '';
            
            // Set modal content
            modalTitle.textContent = title;
            modalDesc.textContent = desc;
            modalPoster.src = poster;
            
            if (rating) {
                modalRating.textContent = `‚≠ê ${rating}`;
                modalRating.style.display = 'inline-block';
            } else {
                modalRating.style.display = 'none';
            }
            
            if (year) {
                modalYear.textContent = year;
                modalYear.style.display = 'inline-block';
            } else {
                modalYear.style.display = 'none';
            }
            
            // Create genre badges
            modalGenres.innerHTML = '';
            if (genres) {
                genres.split(', ').forEach(genre => {
                    if (genre.trim()) {
                        const badge = document.createElement('span');
                        badge.className = 'badge bg-light text-dark me-1 mb-1';
                        badge.textContent = genre;
                        modalGenres.appendChild(badge);
                    }
                });
            }
            
            // For demo purposes - you'd want to set actual movie detail URL
            modalDetailsLink.href = '#';
            addToCartBtn.onclick = function() {
                // Add to cart functionality - would link to your cart view
                alert(`Added "${title}" to cart!`);
                modal.hide();
            };
            
            modal.show();
        }
        
        // Quick view buttons
        document.querySelectorAll('.btn-quick-view').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                openModalFromData(e.currentTarget);
            });
        });
        
        // Click entire card (except buttons)
        cards.forEach(card => {
            card.addEventListener('click', (e) => {
                if (!e.target.closest('button')) {
                    openModalFromData(card);
                }
            });
        });
        
        // Genre filter event listeners
        genres.forEach(genre => {
            genre.addEventListener('click', () => {
                filterByGenre(genre.dataset.genre);
                
                // Smooth scroll to movies grid
                document.getElementById('moviesGrid').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            });
        });
        
        // Search suggestions
        const searchSuggestions = [
            'action movies',
            'comedy films',
            'sci-fi',
            'romance',
            '2024 releases',
            'award winning'
        ];
        
        if (searchHint) {
            let suggestionIndex = 0;
            setInterval(() => {
                if (!searchInput.matches(':focus') && searchInput.value === '') {
                    searchHint.textContent = `Try: "${searchSuggestions[suggestionIndex]}"`;
                    suggestionIndex = (suggestionIndex + 1) % searchSuggestions.length;
                }
            }, 3000);
        }
        
        // Clear filters function
        window.clearFilters = function() {
            filterByGenre('');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Show toast notification
            const toast = document.createElement('div');
            toast.className = 'position-fixed bottom-0 end-0 m-3 p-3 bg-success text-white rounded shadow';
            toast.style.zIndex = '1050';
            toast.innerHTML = '<span class="me-2">‚úì</span> Filters cleared!';
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        };
        
        // Initialize with all genres showing
        filterByGenre('');
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                if (searchInput) {
                    searchInput.focus();
                }
            }
            
            if (e.key === 'Escape') {
                modal.hide();
            }
        });
        
        // Add tooltip to search input
        if (searchInput) {
            searchInput.title = 'Press / to focus search';
        }
    })();
</script>
{% endblock content %}